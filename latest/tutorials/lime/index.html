
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../introduction/">
      
      
        <link rel="next" href="../../reference/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>LIME - Meteors</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#explanations-for-cloud-segmentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Meteors" class="md-header__button md-logo" aria-label="Meteors" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Meteors
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LIME
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Meteors" class="md-nav__button md-logo" aria-label="Meteors" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Meteors
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üè† Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üöÄ Quickstart
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    üìö Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üìö Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üéì Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    LIME
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    LIME
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Environment preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-the-model-unetmobv2_v1" class="md-nav__link">
    <span class="md-ellipsis">
      Load the model - UNetMobV2_V1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explanations" class="md-nav__link">
    <span class="md-ellipsis">
      Explanations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Explanations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spatial-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Spatial analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spectral-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Spectral analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üìñ API Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    üìù Changelog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ü§ù How to Contribute
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Environment preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-the-model-unetmobv2_v1" class="md-nav__link">
    <span class="md-ellipsis">
      Load the model - UNetMobV2_V1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explanations" class="md-nav__link">
    <span class="md-ellipsis">
      Explanations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Explanations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spatial-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Spatial analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spectral-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Spectral analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="explanations-for-cloud-segmentation">Explanations for cloud segmentation</h1>
<h2 id="introduction">Introduction</h2>
<p>The selected model for performing the cloud segmentation is <em>UNetMobV2_V1</em>, which is work based on the paper <em><code>CloudSEN12</code>, a global dataset for semantic understanding of cloud and cloud shadow in <code>Sentinel-2</code></em> Aybar et. al.</p>
<h2 id="environment-preparation">Environment preparation</h2>
<p>In the folder <code>cloudsen12_models</code> there exists code sourced from repository https://github.com/Fersoil/cloudsen12_models/tree/main in which there is slightly modified model source that has been tailored to better work with torch tensors.</p>
<p>The only requirement that should suffice for running the code below is installed <code>meteors</code> package.</p>
<p>Additionally, in order to download the Sentinel-2 images, you may need to authentificate using the Google Earth Engine.</p>
<p>The image and model preparation was sourced from <a href="https://github.com/IPL-UV/cloudsen12_models/blob/main/notebooks/run_in_gee_image.ipynb">this notebook</a></p>
<pre><code class="language-python">import os
from cloudsen12_models import cloudsen12
import ee
import matplotlib.pyplot as plt
from georeader import plot
from shapely.geometry import box
from georeader.readers import ee_image

os.environ[&quot;KMP_DUPLICATE_LIB_OK&quot;] = &quot;TRUE&quot;
</code></pre>
<pre><code>c:\Users\tymot\miniconda3\envs\xai-tutorial\Lib\site-packages\tqdm\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</code></pre>
<pre><code class="language-python"># ee.Authenticate() # if running the notebook for the first time, uncomment this line
ee.Initialize(project=&quot;cloud-segmentation-tkwiecinski&quot;)  # you probably would like to provide your own project name
</code></pre>
<pre><code class="language-python">collection_name = &quot;COPERNICUS/S2_HARMONIZED&quot;
tile = &quot;S2A_MSIL1C_20240417T064631_N0510_R020_T40RCN_20240417T091941&quot;
img_col = ee.ImageCollection(collection_name)
image = img_col.filter(ee.Filter.eq(&quot;PRODUCT_ID&quot;, tile)).first()
info_img = image.getInfo()
</code></pre>
<pre><code class="language-python">%%time

# projgee = image.select(&quot;B2&quot;).projection().getInfo()

aoi = box(55.325, 25.225, 55.415, 25.28)

bands = [&quot;B1&quot;, &quot;B2&quot;, &quot;B3&quot;, &quot;B4&quot;, &quot;B5&quot;, &quot;B6&quot;, &quot;B7&quot;, &quot;B8&quot;, &quot;B8A&quot;, &quot;B9&quot;, &quot;B10&quot;, &quot;B11&quot;, &quot;B12&quot;]
crs = info_img[&quot;bands&quot;][1][&quot;crs&quot;]
transform = info_img[&quot;bands&quot;][1][&quot;crs_transform&quot;]
projgee = {&quot;crs&quot;: crs, &quot;transform&quot;: transform}
# img_local = ee_image.export_image_fast(image=image, geometry=aoi)
img_local = ee_image.export_image_getpixels(asset_id=info_img[&quot;id&quot;], proj=projgee, bands_gee=bands, geometry=aoi)
</code></pre>
<pre><code>CPU times: total: 93.8 ms
Wall time: 3.52 s
</code></pre>
<pre><code class="language-python">swirnirred = (img_local.isel({&quot;band&quot;: [bands.index(b) for b in [&quot;B11&quot;, &quot;B8&quot;, &quot;B4&quot;]]}) / 4_500.0).clip(0, 1)

plot.show(swirnirred)
</code></pre>
<pre><code>&lt;Axes: &gt;
</code></pre>
<p><img alt="png" src="../lime_files/lime_6_1.png" /></p>
<h2 id="load-the-model-unetmobv2_v1">Load the model - UNetMobV2_V1</h2>
<pre><code class="language-python">model = cloudsen12.load_model_by_name(name=&quot;UNetMobV2_V1&quot;, weights_folder=&quot;cloudsen12_models&quot;)
</code></pre>
<pre><code>c:\Users\tymot\Documents\praca\pineapple\meteors\examples\lime\cloudsen12_models\cloudsen12.py:193: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  weights = torch.load(weights_file, map_location=device)
</code></pre>
<pre><code class="language-python">cloudsen12.MODELS_CLOUDSEN12.keys()
</code></pre>
<pre><code>dict_keys(['cloudsen12', 'UNetMobV2_V1', 'UNetMobV2_V2', 'cloudsen12l2a', 'dtacs4bands', 'landsat30'])
</code></pre>
<pre><code class="language-python">cloudmask = model.predict(img_local / 10_000)
</code></pre>
<pre><code class="language-python">fig, ax = plt.subplots(1, 2, figsize=(14, 5), sharey=True, tight_layout=True)

plot.show(swirnirred, ax=ax[0])
cloudsen12.plot_cloudSEN12mask(cloudmask, ax=ax[1])
fig.suptitle(&quot;Cloud mask generated by UNetMobV2_V1&quot;)
</code></pre>
<pre><code>Text(0.5, 0.98, 'Cloud mask generated by UNetMobV2_V1')
</code></pre>
<p><img alt="png" src="../lime_files/lime_11_1.png" /></p>
<h2 id="explanations">Explanations</h2>
<pre><code class="language-python">import meteors as mt
import torch
import numpy as np

sentinel_central_wavelengths = [
    442.7,
    492.4,
    559.8,
    664.6,
    704.1,
    740.5,
    782.8,
    832.8,
    864.7,
    945.1,
    1373.5,
    1613.7,
    2202.4,
]
</code></pre>
<pre><code class="language-python">hsi_image = mt.HSI(
    image=img_local.values.astype(float) / img_local.values.max(), wavelengths=sentinel_central_wavelengths
)

mt.visualize.visualize_hsi(hsi_image)
</code></pre>
<pre><code>&lt;Axes: &gt;
</code></pre>
<p><img alt="png" src="../lime_files/lime_14_1.png" /></p>
<pre><code class="language-python">explainable_model = mt.models.ExplainableModel(model.predict, problem_type=&quot;segmentation&quot;)
</code></pre>
<pre><code class="language-python">segmentation_mask_raw = explainable_model(hsi_image.image)
segmentation_mask_raw = torch.tensor(segmentation_mask_raw)

plt.imshow(segmentation_mask_raw[0])
plt.axis(&quot;off&quot;)
</code></pre>
<pre><code>C:\Users\tymot\AppData\Local\Temp\ipykernel_34972\2061039508.py:2: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  segmentation_mask_raw = torch.tensor(segmentation_mask_raw)





(-0.5, 915.5, 621.5, -0.5)
</code></pre>
<p><img alt="png" src="../lime_files/lime_16_2.png" /></p>
<p>In order to create explanations we need to transform the problem into a simpler regression problem using a postprocessing function.</p>
<pre><code class="language-python">from meteors.utils import agg_segmentation_postprocessing

postprocessing = agg_segmentation_postprocessing(classes_numb=4)
</code></pre>
<pre><code class="language-python">binary_mask = torch.ones_like(segmentation_mask_raw).to(torch.bool)

aggregated_segmentation_mask = postprocessing(segmentation_mask_raw, binary_mask)
</code></pre>
<pre><code class="language-python">plt.bar(np.arange(4), aggregated_segmentation_mask)
plt.xticks(np.arange(4), [&quot;clear&quot;, &quot;thick cloud&quot;, &quot;thin cloud&quot;, &quot;shadow&quot;])
plt.title(&quot;Aggregated cloudSEN12 segmentation&quot;)
plt.ylabel(&quot;Number of pixels&quot;)
plt.xlabel(&quot;Class&quot;)
</code></pre>
<pre><code>Text(0.5, 0, 'Class')
</code></pre>
<p><img alt="png" src="../lime_files/lime_20_1.png" /></p>
<p>having transformed the segmentation mask produced by the model into a 1d tensor, we are ready to create explanations for this problem type!</p>
<h3 id="spatial-analysis">Spatial analysis</h3>
<pre><code class="language-python">lime = mt.attr.Lime(explainable_model=explainable_model)

seg_mask = lime.get_segmentation_mask(hsi_image, segmentation_method=&quot;slic&quot;, num_interpret_features=100)

attributes = lime.get_spatial_attributes(
    hsi_image, target=0, segmentation_mask=seg_mask, postprocessing_segmentation_output=postprocessing
)
</code></pre>
<pre><code>[32m2024-09-25 21:57:53.233[0m | [33m[1mWARNING [0m | [36mmeteors.attr.explainer[0m:[36mdevice[0m:[36m153[0m - [33m[1mNot a torch model, setting device to cpu[0m
</code></pre>
<pre><code class="language-python">fig, ax = mt.visualize.visualize_spatial_attributes(attributes, use_pyplot=False)
fig.suptitle(&quot;LIME explanation for the UNetMobV2_V1 model and class 0 (clear)&quot;)
ax[2].clear()
ax[2].imshow(segmentation_mask_raw[0])
ax[2].axis(&quot;off&quot;)
ax[2].set_title(&quot;UNetMobV2_V1 segmentation&quot;)
print(f&quot;Score of the attribution: {attributes.score}&quot;)
</code></pre>
<pre><code>Score of the attribution: 1.0
</code></pre>
<p><img alt="png" src="../lime_files/lime_23_1.png" /></p>
<pre><code class="language-python">attributes = lime.get_spatial_attributes(
    hsi_image, target=1, segmentation_mask=seg_mask, postprocessing_segmentation_output=postprocessing, num_samples=100
)

fig, ax = mt.visualize.visualize_spatial_attributes(attributes, use_pyplot=False)
fig.suptitle(&quot;LIME explanation for the UNetMobV2_V1 model and class 1 (thick cloud)&quot;)
ax[2].clear()
ax[2].imshow(segmentation_mask_raw[0])
ax[2].axis(&quot;off&quot;)
ax[2].set_title(&quot;UNetMobV2_V1 segmentation&quot;)
print(f&quot;Score of the attribution: {attributes.score}&quot;)
</code></pre>
<pre><code>c:\Users\tymot\miniconda3\envs\xai-tutorial\Lib\site-packages\sklearn\linear_model\_coordinate_descent.py:697: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 4.912e+04, tolerance: 4.610e+04
  model = cd_fast.enet_coordinate_descent(


Score of the attribution: 1.0
</code></pre>
<p><img alt="png" src="../lime_files/lime_24_2.png" /></p>
<h3 id="spectral-analysis">Spectral analysis</h3>
<pre><code class="language-python">band_indices = {
    &quot;B01&quot;: 0,
    &quot;B02&quot;: 1,
    &quot;B03&quot;: 2,
    &quot;B04&quot;: 3,
    &quot;B05&quot;: 4,
    &quot;B06&quot;: 5,
    &quot;B07&quot;: 6,
    &quot;B08&quot;: 7,
    &quot;B8A&quot;: 8,
    &quot;B09&quot;: 9,
    &quot;B10&quot;: 10,
    &quot;B11&quot;: 11,
    &quot;B12&quot;: 12,
}

band_mask, band_names = lime.get_band_mask(hsi_image, band_indices=band_indices)

attributes = lime.get_spectral_attributes(
    hsi_image, target=0, band_mask=band_mask, band_names=band_names, postprocessing_segmentation_output=postprocessing
)
</code></pre>
<pre><code>c:\Users\tymot\miniconda3\envs\xai-tutorial\Lib\site-packages\meteors\attr\lime_base.py:738: UserWarning: Minimum element in feature mask is not 0, shifting indices to start at 0.
  warnings.warn("Minimum element in feature mask is not 0, shifting indices to" " start at 0.")


[32m2024-09-25 22:01:37.043[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
[32m2024-09-25 22:01:39.004[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
[32m2024-09-25 22:01:40.036[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
</code></pre>
<pre><code class="language-python">mt.visualize.visualize_spectral_attributes(attributes)
print(f&quot;Score of the attribution: {attributes.score}&quot;)
fig = plt.gcf()
fig.suptitle(&quot;LIME explanation for the UNetMobV2_V1 model and class 0 (clear)&quot;)
plt.show()
</code></pre>
<pre><code>Score of the attribution: 1.0
</code></pre>
<p><img alt="png" src="../lime_files/lime_27_1.png" /></p>
<p>the bands B11, B08 and B04 are used usually to segment the clouds. This hints that possibly, this method of explanations is valid</p>
<pre><code class="language-python">attributes = lime.get_spectral_attributes(
    hsi_image,
    target=1,
    band_mask=band_mask,
    band_names=band_names,
    postprocessing_segmentation_output=postprocessing,
    n_samples=100,
    perturbations_per_eval=20,
)

mt.visualize.visualize_spectral_attributes(attributes)
print(f&quot;Score of the attribution: {attributes.score}&quot;)
fig = plt.gcf()
fig.suptitle(&quot;LIME explanation for the UNetMobV2_V1 model and class 1 (thick cloud)&quot;)
plt.show()
</code></pre>
<pre><code>c:\Users\tymot\miniconda3\envs\xai-tutorial\Lib\site-packages\meteors\attr\lime_base.py:738: UserWarning: Minimum element in feature mask is not 0, shifting indices to start at 0.
  warnings.warn("Minimum element in feature mask is not 0, shifting indices to" " start at 0.")


[32m2024-09-25 22:00:54.608[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
[32m2024-09-25 22:01:04.547[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
[32m2024-09-25 22:01:14.198[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
[32m2024-09-25 22:01:23.991[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
[32m2024-09-25 22:01:33.421[0m | [33m[1mWARNING [0m | [36mmeteors.utils[0m:[36madjust_shape[0m:[36m112[0m - [33m[1mThe source tensor could not be broadcasted to match the target tensor shape. Broadcasting target tensor to match the source tensor shape.[0m
Score of the attribution: 0.5755875110626221
</code></pre>
<p><img alt="png" src="../lime_files/lime_29_2.png" /></p>
<pre><code class="language-python">
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>